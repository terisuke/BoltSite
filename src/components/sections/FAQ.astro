---
import { getLocaleFromPathname, getTranslation } from '../../utils/i18n';
import { translations } from '../../utils/translations';

export interface Props {
  currentPath?: string;
}

const { currentPath } = Astro.props;

// 現在の言語を取得
const currentLocale = getLocaleFromPathname(currentPath || Astro.url.pathname);
const t = translations[currentLocale] || translations.ja;

// 翻訳関数
const translate = (key: string) => getTranslation(t, key);

// FAQ構造化データを生成
const faqStructuredData = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": translate('faq.questions.pagespeed.question'),
      "acceptedAnswer": {
        "@type": "Answer",
        "text": translate('faq.questions.pagespeed.answer') + " " + translate('faq.questions.pagespeed.features').join(', ') + ". " + translate('faq.questions.pagespeed.guarantee')
      }
    },
    {
      "@type": "Question",
      "name": translate('faq.questions.updates.question'),
      "acceptedAnswer": {
        "@type": "Answer",
        "text": translate('faq.questions.updates.answer') + " " + translate('faq.questions.updates.emergency')
      }
    },
    {
      "@type": "Question",
      "name": translate('faq.questions.refund.question'),
      "acceptedAnswer": {
        "@type": "Answer",
        "text": translate('faq.questions.refund.answer') + " " + translate('faq.questions.refund.conditions').join(', ') + ". " + translate('faq.questions.refund.process')
      }
    },
    {
      "@type": "Question",
      "name": translate('faq.questions.cancellation.question'),
      "acceptedAnswer": {
        "@type": "Answer",
        "text": translate('faq.questions.cancellation.condition_text') + " " + translate('faq.questions.cancellation.reason') + " " + translate('faq.questions.cancellation.benefits').join(', ')
      }
    },
    {
      "@type": "Question",
      "name": translate('faq.questions.tech_stack.question'),
      "acceptedAnswer": {
        "@type": "Answer",
        "text": translate('faq.questions.tech_stack.answer') + " " + translate('faq.questions.tech_stack.note')
      }
    },
    {
      "@type": "Question",
      "name": translate('faq.questions.multilingual.question'),
      "acceptedAnswer": {
        "@type": "Answer",
        "text": translate('faq.questions.multilingual.answer') + " " + translate('faq.questions.multilingual.support')
      }
    }
  ]
};
---

<!-- FAQ構造化データ -->
<script type="application/ld+json" set:html={JSON.stringify(faqStructuredData)}></script>

<section id="faq" class="py-20 bg-white">
  <div class="container mx-auto px-4">
    <div class="max-w-4xl mx-auto">
      
      <!-- セクションタイトル -->
      <div class="text-center mb-16">
        <h2 class="text-4xl font-bold text-gray-900 mb-4">
          {translate('nav.faq')}
        </h2>
        <p class="text-xl text-gray-600">
          {translate('faq.subtitle')}
        </p>
      </div>
      
      <!-- FAQアコーディオン -->
      <div class="space-y-4">
        
        <!-- Q1: PageSpeed保証について -->
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <button class="w-full px-6 py-4 text-left bg-gray-100 hover:bg-gray-200 transition-colors duration-300 flex items-center justify-between" onclick="toggleFAQ('faq1')">
            <h3 class="text-lg font-semibold text-gray-900">
              {translate('faq.questions.pagespeed.question')}
            </h3>
            <svg class="w-5 h-5 text-gray-500 transition-transform duration-300" id="faq1-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <div class="hidden px-6 py-4" id="faq1-content">
            <p class="text-gray-700 mb-4">
              {translate('faq.questions.pagespeed.answer')}
            </p>
            <ul class="space-y-2 text-sm text-gray-600">
              {translate('faq.questions.pagespeed.features').map((feature: string) => (
                <li class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                  {feature}
                </li>
              ))}
            </ul>
            <p class="text-sm text-gray-600 mt-4">
              {translate('faq.questions.pagespeed.guarantee')}
            </p>
          </div>
        </div>
        
        <!-- Q2: 更新頻度について -->
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <button class="w-full px-6 py-4 text-left bg-gray-100 hover:bg-gray-200 transition-colors duration-300 flex items-center justify-between" onclick="toggleFAQ('faq2')">
            <h3 class="text-lg font-semibold text-gray-900">
              {translate('faq.questions.updates.question')}
            </h3>
            <svg class="w-5 h-5 text-gray-500 transition-transform duration-300" id="faq2-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <div class="hidden px-6 py-4" id="faq2-content">
            <p class="text-gray-700 mb-4">
              {translate('faq.questions.updates.answer')}
            </p>
            <ul class="space-y-2 text-sm text-gray-600">
              <li class="flex items-center gap-2">
                <span class="font-semibold text-blue-600">{translate('faq.questions.updates.plan_names.basic')}:</span>
                <span>{translate('faq.questions.updates.plan_limits.basic')}</span>
              </li>
              <li class="flex items-center gap-2">
                <span class="font-semibold text-blue-600">{translate('faq.questions.updates.plan_names.standard')}:</span>
                <span>{translate('faq.questions.updates.plan_limits.standard')}</span>
              </li>
              <li class="flex items-center gap-2">
                <span class="font-semibold text-blue-600">{translate('faq.questions.updates.plan_names.premium')}:</span>
                <span>{translate('faq.questions.updates.plan_limits.premium')}</span>
              </li>
              <li class="flex items-center gap-2">
                <span class="font-semibold text-blue-600">{translate('faq.questions.updates.plan_names.enterprise')}:</span>
                <span>{translate('faq.questions.updates.plan_limits.enterprise')}</span>
              </li>
            </ul>
            <p class="text-sm text-gray-600 mt-4">
              {translate('faq.questions.updates.emergency')}
            </p>
          </div>
        </div>
        
        <!-- Q3: 返金条件について -->
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <button class="w-full px-6 py-4 text-left bg-gray-100 hover:bg-gray-200 transition-colors duration-300 flex items-center justify-between" onclick="toggleFAQ('faq3')">
            <h3 class="text-lg font-semibold text-gray-900">
              {translate('faq.questions.refund.question')}
            </h3>
            <svg class="w-5 h-5 text-gray-500 transition-transform duration-300" id="faq3-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <div class="hidden px-6 py-4" id="faq3-content">
            <p class="text-gray-700 mb-4">
              {translate('faq.questions.refund.answer')}
            </p>
            <ul class="space-y-2 text-sm text-gray-600">
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                {translate('faq.questions.refund.conditions')[0]}
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                {translate('faq.questions.refund.conditions')[1]}
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                {translate('faq.questions.refund.conditions')[2]}
              </li>
            </ul>
            <p class="text-sm text-gray-600 mt-4">
              {translate('faq.questions.refund.process')}
            </p>
          </div>
        </div>
        
        <!-- Q4: 解約ポリシーについて -->
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <button class="w-full px-6 py-4 text-left bg-gray-100 hover:bg-gray-200 transition-colors duration-300 flex items-center justify-between" onclick="toggleFAQ('faq4')">
            <h3 class="text-lg font-semibold text-gray-900">
              {translate('faq.questions.cancellation.question')}
            </h3>
            <svg class="w-5 h-5 text-gray-500 transition-transform duration-300" id="faq4-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <div class="hidden px-6 py-4" id="faq4-content">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
              <p class="text-yellow-800 font-semibold mb-2">{translate('faq.questions.cancellation.condition_title')}</p>
              <p class="text-sm text-yellow-700">
                {translate('faq.questions.cancellation.condition_text')}
              </p>
            </div>
            <p class="text-gray-700 mb-4">
              {translate('faq.questions.cancellation.reason')}
            </p>
            <ul class="space-y-2 text-sm text-gray-600">
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                {translate('faq.questions.cancellation.benefits')[0]}
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                {translate('faq.questions.cancellation.benefits')[1]}
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                {translate('faq.questions.cancellation.benefits')[2]}
              </li>
            </ul>
          </div>
        </div>
        
        <!-- Q5: 技術スタックについて -->
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <button class="w-full px-6 py-4 text-left bg-gray-100 hover:bg-gray-200 transition-colors duration-300 flex items-center justify-between" onclick="toggleFAQ('faq5')">
            <h3 class="text-lg font-semibold text-gray-900">
              {translate('faq.questions.tech_stack.question')}
            </h3>
            <svg class="w-5 h-5 text-gray-500 transition-transform duration-300" id="faq5-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <div class="hidden px-6 py-4" id="faq5-content">
            <p class="text-gray-700 mb-4">
              {translate('faq.questions.tech_stack.answer')}
            </p>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="bg-white rounded-lg p-4 border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-2">{translate('faq.questions.tech_stack.frontend.title')}</h4>
                <ul class="space-y-1 text-sm text-gray-600">
                  <li>• {translate('faq.questions.tech_stack.frontend.items')[0]}</li>
                  <li>• {translate('faq.questions.tech_stack.frontend.items')[1]}</li>
                  <li>• {translate('faq.questions.tech_stack.frontend.items')[2]}</li>
                </ul>
              </div>
              <div class="bg-white rounded-lg p-4 border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-2">{translate('faq.questions.tech_stack.infrastructure.title')}</h4>
                <ul class="space-y-1 text-sm text-gray-600">
                  <li>• {translate('faq.questions.tech_stack.infrastructure.items')[0]}</li>
                  <li>• {translate('faq.questions.tech_stack.infrastructure.items')[1]}</li>
                  <li>• {translate('faq.questions.tech_stack.infrastructure.items')[2]}</li>
                </ul>
              </div>
            </div>
            <p class="text-sm text-gray-600 mt-4">
              {translate('faq.questions.tech_stack.note')}
            </p>
          </div>
        </div>
        
        <!-- Q6: 多言語対応について -->
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <button class="w-full px-6 py-4 text-left bg-gray-100 hover:bg-gray-200 transition-colors duration-300 flex items-center justify-between" onclick="toggleFAQ('faq6')">
            <h3 class="text-lg font-semibold text-gray-900">
              {translate('faq.questions.multilingual.question')}
            </h3>
            <svg class="w-5 h-5 text-gray-500 transition-transform duration-300" id="faq6-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <div class="hidden px-6 py-4" id="faq6-content">
            <p class="text-gray-700 mb-4">
              {translate('faq.questions.multilingual.answer')}
            </p>
            <ul class="space-y-2 text-sm text-gray-600">
              <li class="flex items-center gap-2">
                <span class="font-semibold text-gray-900">{translate('faq.questions.multilingual.details.languages').split(':')[0]}:</span>
                <span>{translate('faq.questions.multilingual.details.languages').split(':')[1]}</span>
              </li>
              <li class="flex items-center gap-2">
                <span class="font-semibold text-gray-900">{translate('faq.questions.multilingual.details.quality').split(':')[0]}:</span>
                <span>{translate('faq.questions.multilingual.details.quality').split(':')[1]}</span>
              </li>
              <li class="flex items-center gap-2">
                <span class="font-semibold text-gray-900">{translate('faq.questions.multilingual.details.switching').split(':')[0]}:</span>
                <span>{translate('faq.questions.multilingual.details.switching').split(':')[1]}</span>
              </li>
            </ul>
            <p class="text-sm text-gray-600 mt-4">
              {translate('faq.questions.multilingual.support')}
            </p>
          </div>
        </div>
      </div>
      
      <!-- その他の質問 -->
      <div class="text-center mt-12">
        <div class="bg-blue-50 rounded-2xl p-8">
          <h3 class="text-xl font-bold text-gray-900 mb-4">
            {translate('faq.other_questions.title')}
          </h3>
          <p class="text-gray-600 mb-6">
            {translate('faq.other_questions.description')}
          </p>
          <a href="#contact" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-semibold transition-colors duration-300 inline-block">
            {translate('faq.other_questions.button')}
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  function toggleFAQ(id) {
    const content = document.getElementById(id + '-content');
    const icon = document.getElementById(id + '-icon');
    
    if (content.classList.contains('hidden')) {
      content.classList.remove('hidden');
      icon.style.transform = 'rotate(180deg)';
    } else {
      content.classList.add('hidden');
      icon.style.transform = 'rotate(0deg)';
    }
  }
</script>
